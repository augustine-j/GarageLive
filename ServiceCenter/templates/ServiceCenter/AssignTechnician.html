{% extends 'ServiceCenter/Head_service.html' %}
{% block content %}
{% load static %}

<div class="container-xxl py-4">
  <div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card shadow-sm">
        <div class="card-body">

          <!-- Header -->
          <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
            <div>
              <h4 class="card-title mb-1">
                <span class="blink-dot"></span> Assign Technician
              </h4>
              <p class="card-description mb-0">
                Select a technician to assign this request.
              </p>
            </div>
          </div>

          <!-- Technician Table -->
          <form method="post">
            {% csrf_token %}

            <div class="table-responsive">
              <table class="table table-striped align-middle">
                <thead>
                  <tr>
                    <th style="width:70px;">S.No</th>
                    <th>Technician</th>
                    <th>Contact</th>
                    <th>Status</th>
                    <th style="width:160px;">Photo</th>
                    <th style="width:160px;">Action</th>
                  </tr>
                </thead>

                <tbody>
                  {% for i in data %}
                  <tr>
                    <td class="fw-semibold">{{ forloop.counter }}</td>

                    <!-- Technician Info -->
                    <td>
                      <div class="d-flex flex-column">
                        <span class="fw-semibold">{{ i.technician_name }}</span>
                        <small class="text-muted">{{ i.technician_email }}</small>
                      </div>
                    </td>

                    <!-- Contact -->
                    <td>
                      <span class="fw-semibold">{{ i.technician_contact }}</span>
                    </td>

                    <!-- Availability -->
                    <td>
                      {% if i.id in busy_ids %}
                        <span class="badge bg-danger">Busy</span>
                      {% else %}
                        <span class="badge bg-success">Available</span>
                      {% endif %}
                    </td>

                    <!-- Photo -->
                    <td>
                      <img
                        src="{{ i.technician_photo.url }}"
                        alt="Technician Photo"
                        class="img-fluid rounded shadow-sm"
                        style="width:110px; height:90px; object-fit:cover;"
                      />
                    </td>

                    <!-- Action -->
                    <td>
                      {% if i.id in busy_ids %}
                        <button class="btn btn-sm btn-secondary" disabled>
                          Assign
                        </button>
                      {% else %}

                        {% if mode == "service" %}
                          <a
                            href="{% url 'ServiceCenter:assignjob' i.id bid %}"
                            class="btn btn-sm btn-primary"
                            onclick="return confirm('Assign this service job to {{ i.technician_name }}?');"
                          >
                            Assign
                          </a>

                        {% elif mode == "breakdown" %}
                          <a
                            href="{% url 'ServiceCenter:assign_breakdown' i.id btid %}"
                            class="btn btn-sm btn-warning"
                            onclick="return confirm('Assign this breakdown request to {{ i.technician_name }}?');"
                          >
                            Assign
                          </a>
                        {% endif %}

                      {% endif %}
                    </td>
                  </tr>

                  {% empty %}
                  <tr>
                    <td colspan="6" class="text-center text-muted py-4">
                      No technicians available.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>

              </table>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Blinking dot style -->
<style>
  .blink-dot {
    width: 9px;
    height: 9px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 6px;
    background-color: #dc3545;
    animation: blink 1.3s infinite;
  }
  @keyframes blink {
    0%,100% { opacity: 1; }
    50% { opacity: .3; }
  }
</style>

{% endblock content %}
