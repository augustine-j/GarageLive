{% extends 'User/Head_User.html' %}
{% block content %}

<style>
  .sc-stars i {
    color: #f59e0b;
    font-size: 14px;
    margin-right: 2px;
}

</style>

<div class="container-fluid bg-secondary booking my-5 wow fadeInUp" data-wow-delay="0.1s">
  <div class="container">
    <div class="row gx-5">

      <!-- LEFT INFO -->
      <div class="col-lg-6 py-5">
        <div class="py-5">
          <span class="badge bg-danger mb-3 px-3 py-2">Emergency</span>
          <h1 class="text-white mb-4">Breakdown Assist</h1>
          <p class="text-white mb-0">
            Select your district and place to find nearby service centers for immediate breakdown assistance.
          </p>

          <div class="mt-4 p-4 bg-primary bg-opacity-25 rounded">
            <h5 class="text-white mb-2">What to do</h5>
            <ul class="text-white-50 mb-0 ps-3">
              <li>Select your current location</li>
              <li>Choose a nearby service center</li>
              <li>Book breakdown assistance</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- RIGHT FILTER -->
      <div class="col-lg-6">
        <div class="bg-primary h-100 d-flex flex-column justify-content-center text-center p-5 wow zoomIn">
          <h1 class="text-white mb-4">Find Help Near You</h1>

          <form method="post">
            {% csrf_token %}
            <div class="row g-3">

              <div class="col-12 col-sm-6 text-start">
                <label class="text-white-50 fw-semibold mb-2">District</label>
                <select name="sel_district" id="sel_district"
                        class="form-select border-0" style="height:55px;" required>
                  <option value="">Select District</option>
                  {% for i in districtdata %}
                  <option value="{{i.id}}">{{i.district_name}}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-12 col-sm-6 text-start">
                <label class="text-white-50 fw-semibold mb-2">Place</label>
                <select name="sel_place" id="sel_place"
                        class="form-select border-0" style="height:55px;" required>
                  <option value="">Select Place</option>
                </select>
              </div>

              <div class="col-12">
                <button class="btn btn-warning w-100 py-3 fw-bold">
                  Search Breakdown Assistance
                </button>
              </div>

            </div>
          </form>
        </div>
      </div>

    </div>

    <!-- ===== RESULTS SECTION (YOUR STYLE CODE USED AS-IS) ===== -->

    <div class="row mt-5">
      <div class="col-12">

        <!-- YOUR STYLE BLOCK -->
        <style>
          /* Results-only styling */
          .sc-results-wrap{background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.18);border-radius:18px;padding:16px}
          .sc-results-head{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px}
          .sc-results-head h3{margin:0;color:#fff;font-weight:900}
          .sc-count{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.24);color:#fff;font-weight:900;font-size:12px}
          .sc-list{display:flex;flex-direction:column;gap:12px}
          .sc-item{background:#fff;border-radius:18px;border:1px solid rgba(0,0,0,.06);box-shadow:0 12px 26px rgba(0,0,0,.10);overflow:hidden}
          .sc-row{display:grid;grid-template-columns:120px 1fr auto;gap:14px;padding:14px;align-items:center}
          .sc-logo{width:120px;height:96px;border-radius:14px;overflow:hidden;background:#f2f2f2}
          .sc-logo img{width:100%;height:100%;object-fit:cover}
          .sc-name{margin:0;font-size:16px;font-weight:900;color:#0f172a}
          .sc-badges{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
          .sc-pill{padding:7px 10px;border-radius:999px;font-size:12px;font-weight:800}
          .sc-pill.email{background:rgba(47,128,237,.10);color:#1e5fb7}
          .sc-pill.phone{background:rgba(39,174,96,.10);color:#1f7f47}
          .sc-address{margin-top:10px;color:#475569;font-size:13px}
          .sc-action{text-align:right}
          .sc-book{border-radius:14px;font-weight:900}
          .sc-footer{display:flex;justify-content:space-between;padding:10px 14px;background:#f8fafc;font-size:12px}
        </style>

        <div class="sc-results-wrap">
          <div class="sc-results-head">
            <h3>Nearby Service Centers</h3>
            <div class="sc-count">Total: {{ servicecenter|length }}</div>
          </div>

          <div class="sc-list">
            {% for i in servicecenter %}
            <div class="sc-item">
              <div class="sc-row">

                <div class="sc-logo">
                  <img src="{{ i.servicecenter_logo.url }}">
                </div>

                <div>
                  <p class="sc-name">{{ i.servicecenter_name }}</p>
                 {% if i.avg_rating %}
<div class="sc-rating">
  <div class="sc-stars">

   {% for x in "12345" %}
  {% if forloop.counter <= i.full_stars %}
    <i class="fa-solid fa-star"></i>
  {% elif i.half_star and forloop.counter == i.next_star %}
    <i class="fa-solid fa-star-half-stroke"></i>
  {% else %}
    <i class="fa-regular fa-star"></i>
  {% endif %}
{% endfor %}


  </div>

  <div>
    {{ i.avg_rating|floatformat:1 }} / 5
    <small>({{ i.total_reviews }} reviews)</small>
  </div>
</div>
{% else %}
<div class="sc-rating">
  <small>No ratings yet</small>
</div>
{% endif %}



                  <div class="sc-badges">
                    <div class="sc-pill email">Email: {{ i.servicecenter_email }}</div>
                    <div class="sc-pill phone">Contact: {{ i.servicecenter_contact }}</div>
                  </div>

                  <div class="sc-address">
                    {{ i.servicecenter_address }}
                  </div>
                </div>

                <div class="sc-action">
                  <a href="{% url 'User:BreakdownBooking' i.id %}"
                     class="btn btn-warning sc-book">
                    Book Breakdown Assist
                  </a>
                </div>

              </div>

              <div class="sc-footer">
                <span>Emergency support available</span>
                <span>GarageLive</span>
              </div>
            </div>
            {% empty %}
            <p class="text-white">No service centers found</p>
            {% endfor %}
          </div>
        </div>

      </div>
    </div>
  </div>
</div>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
  $('#sel_district').change(function () {
    $.ajax({
      url: "{% url 'User:AjaxLocation' %}",
      data: { did: $(this).val() },
      success: function (data) {
        $('#sel_place').html(data);
      }
    });
  });
</script>

{% endblock content %}
