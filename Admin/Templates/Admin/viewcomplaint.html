{% extends 'Admin/Head_admin.html' %}
{% block content %}

<div class="container-xxl py-4">
  <div class="row">

    <!-- ================= PENDING COMPLAINTS ================= -->
    <div class="col-lg-12 grid-margin stretch-card mb-4">
      <div class="card shadow-sm">
        <div class="card-body">

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h4 class="card-title mb-1">User Complaints</h4>
              <p class="card-description mb-0">
                Complaints submitted by users awaiting reply.
              </p>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th style="width:60px;">S.No</th>
                  <th>User</th>
                  <th>Email</th>
                  <th>Title</th>
                  <th>Complaint</th>
                  <th>Date</th>
                  <th style="width:120px;">Action</th>
                </tr>
              </thead>

              <tbody>
                {% for i in Data %}
                <tr>
                  <td class="fw-semibold">{{ forloop.counter }}</td>

                  <td class="fw-semibold">{{ i.user.user_name }}</td>

                  <td>
                    <small class="text-muted">{{ i.user.user_email }}</small>
                  </td>

                  <td>
                    <span class="badge badge-outline-primary">
                      {{ i.complaint_title }}
                    </span>
                  </td>

                  <td style="max-width:280px;">
                    <div class="text-wrap">{{ i.complaint_content }}</div>
                  </td>

                  <td>
                    <span class="badge badge-outline-dark">
                      {{ i.complaint_date }}
                    </span>
                  </td>

                  <td>
                    <a href="{% url 'Admin:reply' i.id %}"
                       class="btn btn-sm btn-primary">
                      Reply
                    </a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center text-muted py-4">
                    No pending complaints.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>

    <!-- ================= REPLIED COMPLAINTS ================= -->
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card shadow-sm">
        <div class="card-body">

          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h4 class="card-title mb-1">Replied Complaints</h4>
              <p class="card-description mb-0">
                Complaints that have already been replied by admin.
              </p>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th style="width:60px;">S.No</th>
                  <th>User</th>
                  <th>Email</th>
                  <th>Title</th>
                  <th>Complaint</th>
                  <th>Date</th>
                  <th>Reply</th>
                </tr>
              </thead>

              <tbody>
                {% for i in replied %}
                <tr>
                  <td class="fw-semibold">{{ forloop.counter }}</td>

                  <td class="fw-semibold">{{ i.user.user_name }}</td>

                  <td>
                    <small class="text-muted">{{ i.user.user_email }}</small>
                  </td>

                  <td>
                    <span class="badge badge-outline-success">
                      {{ i.complaint_title }}
                    </span>
                  </td>

                  <td style="max-width:260px;">
                    {{ i.complaint_content }}
                  </td>

                  <td>
                    <span class="badge badge-outline-dark">
                      {{ i.complaint_date }}
                    </span>
                  </td>

                  <td style="max-width:300px;">
                    <span class="text-success fw-semibold">
                      {{ i.complaint_reply }}
                    </span>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center text-muted py-4">
                    No replied complaints found.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

{% if msg %}
<script>
  alert("{{ msg }}");
  window.location = "{% url 'Admin:complaint' %}";
</script>
{% endif %}

{% endblock content %}
